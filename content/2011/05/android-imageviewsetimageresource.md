Title: [Android] ImageViewのsetImageResourceでの描画処理
Date: 2011-05-20 10:57:00
Category: 
Tags: Programming,Android
Slug: android-imageviewsetimageresource

<p>ボタンが押されたときのonClickハンドラで、何回もImageView#setImageResourceを呼び出しても、画像は更新されなかった。調べてみたら、onClickのハンドラが抜けてUIスレッドに制御が渡らないと描画されないらしい。それで、結局次のようにして解決した。まず、Runnableを実装するImageControlクラスを作成する。</p><pre class="prettyprint"><br />public class ImageControl implements Runnable{<br />    private ImageView iv;<br />    private int num = 0;<br />    ImageControl(ImageView v){ iv = v; }<br /><br />    @Override<br />    public void run() {<br />        iv.setImageResource(image[num]);<br /><br />        if (num &gt;= 48){<br />            num = 0;<br />        }else{<br />            num++;<br />            iv.postDelayed(this, 10);<br />        }<br />    }<br />}<br /></pre><p>上記で、image配列はあらかじめ用意されているリソース。numが0-48の間は、postDelayedを呼び出すことで、再度runメソッドが呼ばれるようにする。<p><p>そして、onClickハンドラには次の記述を追加する。</p><pre class="prettyprint"><br />imageView.postDelayed(new ImageControl(imageView), 10);<br /></pre><br />つまり、メソッドは次のように繰り返して呼び出される。 <br /><pre>onClick-&gt;imageView#postDelayed-&gt;imageControl#run-&gt;imageView#postDelayed-&gt;imageControl#run-&gt;..</pre><p>画像を切替える必要がある間は、runメソッドの中で再度postDelayedを呼び出してやる。そうすればまたrunメソッドが呼ばれる、という仕組み。そしてrunメソッドの中ではsetImageResourceを呼び出すことで、1枚だけ画像を切り替える。</p><p>これで、ボタンをクリックすると映像が連続して切り替わる動作が実装できた。</p> <SCRIPT charset="utf-8" type="text/javascript" src="http://ws.amazon.co.jp/widgets/q?rt=qf_sp_sr_mfw&ServiceVersion=20070822&MarketPlace=JP&ID=V20070822/JP/formalism-22/8001/f7793475-9567-4d49-8a1f-818a5692b3e2"> </SCRIPT> <NOSCRIPT><A HREF="http://ws.amazon.co.jp/widgets/q?rt=qf_sp_sr_mfw&ServiceVersion=20070822&MarketPlace=JP&ID=V20070822%2FJP%2Fformalism-22%2F8001%2Ff7793475-9567-4d49-8a1f-818a5692b3e2&Operation=NoScript">Amazon.co.jp ウィジェット</A></NOSCRIPT>
